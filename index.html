<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Çetele – Namaz Vakitleri</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0f172a" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: #0f172a;
      color: #f9fafb;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      padding: 1rem;
      text-align: center;
      background: #020617;
      border-bottom: 1px solid #1f2937;
    }
    h1 {
      margin: 0;
      font-size: 1.4rem;
    }
    main {
      flex: 1;
      padding: 1rem;
      max-width: 600px;
      margin: 0 auto;
    }
    .card {
      background: #020617;
      border-radius: 12px;
      padding: 1rem;
      border: 1px solid #1f2937;
      margin-bottom: 1rem;
    }
    .row {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
    }
    input {
      padding: 0.4rem 0.6rem;
      border-radius: 8px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #f9fafb;
      flex: 1;
    }
    button {
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      border: none;
      background: #22c55e;
      color: #022c22;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.9rem;
    }
    button:disabled {
      opacity: 0.7;
      cursor: default;
    }
    .times-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }
    .time-item {
      padding: 0.6rem;
      border-radius: 10px;
      background: #020617;
      border: 1px solid #1f2937;
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }
    .time-label {
      font-size: 0.85rem;
      color: #9ca3af;
    }
    .time-value {
      font-size: 1.05rem;
      font-weight: 600;
    }
    .badge {
      display: inline-block;
      padding: 0.1rem 0.4rem;
      border-radius: 999px;
      border: 1px solid #22c55e;
      font-size: 0.7rem;
      color: #bbf7d0;
      margin-left: 0.2rem;
    }
    .small {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 0.3rem;
    }
    footer {
      text-align: center;
      padding: 0.5rem;
      font-size: 0.75rem;
      color: #6b7280;
    }
    .error {
      color: #fecaca;
      font-size: 0.8rem;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Çetele – Namaz Vakitleri</h1>
    <div id="today"></div>
  </header>

  <main>
    <div class="card">
      <div class="row">
        <input id="city" type="text" value="Duisburg" />
        <input id="country" type="text" value="Germany" />
      </div>
      <button id="loadBtn">Namaz vakitlerini getir</button>
      <div id="error" class="error"></div>
      <p class="small">
        Vakitler <strong>AlAdhan API</strong> üzerinden alınmaktadır.
      </p>
    </div>

    <div class="card">
      <h2 style="margin-top:0; font-size:1.1rem;">Bugünkü Vakitler</h2>
      <div class="times-grid" id="timesGrid"></div>
      <div class="small" id="nightInfo"></div>
    </div>
  </main>

  <footer>
    Çetele – Namaz Vakitleri Uygulaması
  </footer>

  <script>
    const todayEl = document.getElementById("today");
    const loadBtn = document.getElementById("loadBtn");
    const errorEl = document.getElementById("error");
    const timesGrid = document.getElementById("timesGrid");
    const nightInfo = document.getElementById("nightInfo");

    const now = new Date();
    todayEl.textContent = now.toLocaleDateString("tr-TR", {
      weekday: "long",
      year: "numeric",
      month: "long",
      day: "numeric"
    });

    async function loadTimes() {
      errorEl.textContent = "";
      timesGrid.innerHTML = "";
      nightInfo.textContent = "";
      loadBtn.disabled = true;
      loadBtn.textContent = "Yükleniyor...";

      const city = document.getElementById("city").value.trim() || "Duisburg";
      const country = document.getElementById("country").value.trim() || "Germany";

      try {
        const url = `https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country)}&method=13`;
        const res = await fetch(url);
        const data = await res.json();

        if (data.code !== 200) throw new Error("API hatası");

        const t = data.data.timings;
        const items = [
          ["İmsak", t.Imsak],
          ["Sabah (Fecr)", t.Fajr],
          ["Güneş", t.Sunrise],
          ["Öğle", t.Dhuhr],
          ["İkindi", t.Asr],
          ["Akşam", t.Maghrib],
          ["Yatsı", t.Isha]
        ];

        const mag = t.Maghrib.split(":").map(Number);
        const faj = t.Fajr.split(":").map(Number);

        let magTotal = mag[0] * 60 + mag[1];
        let fajTotal = faj[0] * 60 + faj[1];
        if (fajTotal <= magTotal) fajTotal += 1440;

        const nightLength = fajTotal - magTotal;
        const tahajjudStart = fajTotal - Math.floor(nightLength / 3);

        function format(min) {
          const t = ((min % 1440) + 1440) % 1440;
          const h = String(Math.floor(t / 60)).padStart(2, "0");
          const m = String(t % 60).padStart(2, "0");
          return `${h}:${m}`;
        }

        items.forEach(([label, val]) => {
          const div = document.createElement("div");
          div.className = "time-item";
          div.innerHTML = `<div class="time-label">${label}</div>
                           <div class="time-value">${val}</div>`;
          timesGrid.appendChild(div);
        });

        const teheccudDiv = document.createElement("div");
        teheccudDiv.className = "time-item";
        teheccudDiv.innerHTML =
          `<div class="time-label">Teheccüd <span class="badge">son üçte bir</span><
